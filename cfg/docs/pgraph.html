<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-05-02 Tue 14:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WCT <code>pgraph</code> configuration support</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Brett Viren" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">WCT <code>pgraph</code> configuration support</h1>

<div id="outline-container-org2875466" class="outline-2">
<h2 id="org2875466"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
The most popular paradigm in which to use WCT that of data flow
programming (DFP).  This constructs a WCT job as a directed graph
which vertices or <i>nodes</i> made up of executable and potentially
configurable WCT components.  A node has a well defined or variable
number of <i>input ports</i> and <i>output ports</i>.  As such, these kinds of graph
are sometimes called "port graphs" and the "p" in "pgraph" stands for
"port".  Each port allows passage of data objects of a specific
interface type (<code>IData</code>).  A valid graph has exactly one edge to or from
every port and both ports on either end of the edge must pass the same
data type.
</p>

<p>
Describing the connectivity of such a graph is both simple and
complex.  In the end, one must simply provide a configuration in the
form of a flat list of node configuration objects.  Each node
configuration object must have a <code>type</code> attribute naming a WCT component
type.  A <code>name</code> attribute must also be supplied if more than one
instance of a <code>type</code> exists in the list and it must be unique among all
instances of common <code>type</code>.  A <code>name</code> is otherwise optional.  The list of
nodes is accompanied with a list edges where each edge is expressed as
an ordered pair of <code>&lt;type&gt;:&lt;name&gt;</code>.
</p>

<p>
While very simple in representation, properly forming and reasoning
about complex graphs configurations is more difficult.  To help with
this, WCT provides the <code>pgraph.jsonnet</code> library of functions.
</p>
</div>
</div>

<div id="outline-container-org4b6d864" class="outline-2">
<h2 id="org4b6d864"><span class="section-number-2">2.</span> <code>pgraph</code> concepts</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgb5175eb" class="outline-3">
<h3 id="orgb5175eb"><span class="section-number-3">2.1.</span> inode</h3>
<div class="outline-text-3" id="text-2-1">
<p>
In <code>pgraph.jsonnet</code>, a configuration object for an particular instance
of a WCT component that has an <code>INode</code> interface is called an <b>inode</b>.  As
introduced above an <b>inode</b> must have a <code>type</code> attribute and may require a
<code>name</code> attribute.  If the WCT component is configurable (has an
<code>IConfigurable</code> interface) then the <b>inode</b> may also have a <code>data</code> attribute
to supply a configuration parameters to the component instance of a
type given by <code>type</code>.
</p>
</div>
</div>

<div id="outline-container-org85946ef" class="outline-3">
<h3 id="org85946ef"><span class="section-number-3">2.2.</span> pnode</h3>
<div class="outline-text-3" id="text-2-2">
<p>
One very useful intermediate construction which is supported by port
graphs is that of forming a "aggregate" node from a subgraph.  This
hides arbitrary complexity of a subgraph by conceptually presenting
the whole as a single node.  Any unattached ports from any of the
subgraph nodes are assigned to the aggregate node.  A user may connect
this node into a yet larger graph without the need to understand the
internal complexity.  This abstraction can be repeated to arbitrary
scale.  That is one may construct an entire DFP graph as aggregates of
aggregates of nodes, etc.
</p>

<p>
The most important functions in <code>pgraph.jsonnet</code> are those that provide
ways to form various types of subgraph aggregate nodes.  For this to
work, a new type of "node" is required that can represent individual
<b>inode</b> nodes as well as aggregates of <b>inode</b> nodes.  This is called a
<b>pnode</b>.  A <b>pnode</b> is structured similarly to an <b>inode</b>.  It has a <code>type</code>
but all <b>pnode</b> has type of <code>"Pnode"</code>.  A <b>pnode</b> may also have an instance
<code>name</code> with the same governing rules as for <b>inode</b>.  Additional
attributes of a <b>pnode</b> hold the subgraph information and allow
unattached ports of the subgraph to be enumerated as if their were on
the <b>pnode</b> itself.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb9e17ce" class="outline-2">
<h2 id="orgb9e17ce"><span class="section-number-2">3.</span> <code>pgraph</code> functions</h2>
<div class="outline-text-2" id="text-3">
<p>
Here describes the most important functions.  Read the code and
comments in <code>pgraph.jsonnet</code> for details.  In the examples, we will
assume
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">pg</span> = <span style="color: #e090d7;">import</span> <span style="color: #e9b96e;">"pgraph.jsonnet"</span>;
</pre>
</div>
</div>

<div id="outline-container-orgf196bf4" class="outline-3">
<h3 id="orgf196bf4"><span class="section-number-3">3.1.</span> Port</h3>
</div>

<div id="outline-container-org72c0897" class="outline-3">
<h3 id="org72c0897"><span class="section-number-3">3.2.</span> Edge</h3>
</div>

<div id="outline-container-org073e87e" class="outline-3">
<h3 id="org073e87e"><span class="section-number-3">3.3.</span> Atomic pnode</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The simplest <b>pnode</b> is one that represents a single <b>inode</b>.
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">mf</span> = {type:<span style="color: #e9b96e;">"MyFilter"</span>};
<span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">pnode</span> = pg.pnode(mf, nin=<span style="color: #e9b2e3;">1</span>, nout=<span style="color: #e9b2e3;">1</span>);
</pre>
</div>

<p>
If the component has compile-time port cardinality, the <code>nin</code> and <code>nout</code>
arguments <b>must</b> match expectations.  For components with dynamic port
cardinality, <code>nin</code> or <code>nout</code> will set the number to be used.
</p>
</div>
</div>

<div id="outline-container-orgfc06744" class="outline-3">
<h3 id="orgfc06744"><span class="section-number-3">3.4.</span> Pipeline of pnodes</h3>
<div class="outline-text-3" id="text-3-4">
<p>
A very common subgraph pattern is a linear pipeline of nodes.  These
can be aggregated as such:
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">mf1</span> = {type:<span style="color: #e9b96e;">"MyFilter"</span>, name:<span style="color: #e9b96e;">"foo"</span>};
<span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">mf2</span> = {type:<span style="color: #e9b96e;">"MyFilter"</span>, name:<span style="color: #e9b96e;">"bar"</span>};
<span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">pipe</span> = pg.pipeline([mf<span style="color: #e9b2e3;">1</span>,mf<span style="color: #e9b2e3;">2</span>]);
</pre>
</div>

<p>
The input ports of <code>mf1</code> form the input ports of <code>pipe</code> and likewise the
output ports of <code>mf2</code>.
</p>
</div>
</div>

<div id="outline-container-orga6d11e5" class="outline-3">
<h3 id="orga6d11e5"><span class="section-number-3">3.5.</span> Arbitrary subgraph aggregation</h3>
<div class="outline-text-3" id="text-3-5">
<p>
An arbitrary aggregation can be formed with the <code>intern()</code> function.  It
accepts zero or more <b>pnode</b> objects in three collections: <code>innodes</code>,
<code>centernodes</code> and <code>outnodes</code> along with zero or more edges in <code>edges</code> array
and input and output ports in <code>iports</code> and <code>oports</code>.  In principle, all
other <b>pnode</b> creating functions can be implemented as calls to <code>intern()</code>
with some restriction on which of these arguments are passed.
</p>

<p>
Using the <b>pnode</b> instances created above:
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">sg</span> = pg.intern(innodes=[pnode, pipe], outnodes=[pnode,pipe]);
</pre>
</div>

<p>
The result would be a <b>pnode</b> with two input and two output ports taken
from those of <code>pnode</code> and <code>pipe</code>.
</p>

<p>
Emulating the <code>pipeline()</code> function:
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">pipe2</span> = pg.intern(innodes=[mf<span style="color: #e9b2e3;">1</span>],outnodes=[mf<span style="color: #e9b2e3;">2</span>],
                        edges=[pg.edge(mf<span style="color: #e9b2e3;">1</span>,mf<span style="color: #e9b2e3;">2</span>)]);
</pre>
</div>

<p>
Or a longer pipeline with three nodes
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">pipe2</span> = pg.intern(innodes=[mf<span style="color: #e9b2e3;">1</span>],centernodes=[mf],outnodes=[mf<span style="color: #e9b2e3;">2</span>],
                        edges=[pg.edge(mf<span style="color: #e9b2e3;">1</span>,mf), pf.edge(mf,mf<span style="color: #e9b2e3;">2</span>)]);
</pre>
</div>

<p>
So far, the ports of the resulting <b>pnode</b> are calculated assuming all
input ports of input nodes are open and likewise for output.  The
order of these ports on the resulting <b>pnode</b> follows the order of the
nodes in their arrays and the ports in each node.
</p>

<p>
In some cases, ports may no be available for attaching or one may wish
to expose ports in a different order.  In such cases <code>iports</code> and <code>oports</code>
can be explicitly given.
</p>

<p>
For example, a common subgraph pattern is an "edge tap" whereby we
wish to send to its nominal recipient as well as a new consumer.  We
must have exactly one edge per port and so we may not "split an edge".
However, there are components called "fanout" which produce a number
of parallel outputs from each input.
</p>

<p>
Here is a very contrived example:
</p>

<div class="org-src-container">
<pre class="src src-jsonnet"><span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">fanout</span> = pg.pnode({type:<span style="color: #e9b96e;">"MyFanout"</span>}, nin=<span style="color: #e9b2e3;">1</span>, nout=<span style="color: #e9b2e3;">3</span>);
<span style="color: #e090d7;">local</span> <span style="color: #fcaf3e;">tapped</span> = pg.intern(innodes=[mf], centernodes=[fanout], outnodes=[mf<span style="color: #e9b2e3;">1</span>,mf<span style="color: #e9b2e3;">2</span>],
                         edges=[pg.edge(mf,fanout),
                                pg.edge(fanout,mf<span style="color: #e9b2e3;">1</span>,<span style="color: #e9b2e3;">1</span>,<span style="color: #e9b2e3;">0</span>),
                                pg.edge(fanout,mf<span style="color: #e9b2e3;">2</span>,<span style="color: #e9b2e3;">2</span>,<span style="color: #e9b2e3;">0</span>)],
                         oports=[mf<span style="color: #e9b2e3;">2</span>.oports[<span style="color: #e9b2e3;">0</span>], mf<span style="color: #e9b2e3;">1</span>.oports[<span style="color: #e9b2e3;">0</span>], fanout.oports[<span style="color: #e9b2e3;">0</span>]]);
</pre>
</div>

<p>
Output port 0 of the <code>fanout</code> is left unconnected and output port 1 of
the <code>fanout</code> connects to the input port of <code>mf1</code> and likewise for 2.  If
<code>oports</code> were not given then the output ports of the resulting <code>tapped</code>
<b>pnode</b> would be in order port 0 from <code>[fanout,mf1,mf2]</code>.  For reasons
only known to the user, the reverse ordering was explicitly wanted and
given by <code>oports</code>.
</p>
</div>
</div>

<div id="outline-container-org13c74e1" class="outline-3">
<h3 id="org13c74e1"><span class="section-number-3">3.6.</span> Fans and taps</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Note, <code>pgraph</code> provides a subobject called <code>fan</code> with various functions to
construct fan in/out subgraphs: <code>fanout(), fanin(), pipe(), sink()</code>.  It
also provides the <code>tap()</code> function to make constructing "edge taps" as
described above simple.
</p>
</div>
</div>

<div id="outline-container-org6d31171" class="outline-3">
<h3 id="org6d31171"><span class="section-number-3">3.7.</span> Edge insertion</h3>
</div>

<div id="outline-container-org53d3107" class="outline-3">
<h3 id="org53d3107"><span class="section-number-3">3.8.</span> Aggregate closed component graphs</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Brett Viren</p>
<p class="date">Created: 2023-05-02 Tue 14:13</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
